# https://circleci.com/gh/OpenWaterAnalytics/Stormwater-Management-Model/

checkout:
  override:
    # The code to run the regression tests is on a specific branch
    - git clone --depth=50 --branch=feature-nrtest https://github.com/OpenWaterAnalytics/Stormwater-Management-Model.git

dependencies:
  pre:
    # We need cmake 3.x
    - sudo add-apt-repository ppa:george-edison55/cmake-3.x -y
  override:
    - sudo apt update
    - sudo apt install --only-upgrade cmake
    - pip install --upgrade pip
    - pip install wheel
    - cd Stormwater-Management-Model; pip install --src buildprod/packages -r tools/requirements.txt

compile:
  override:
    - cd Stormwater-Management-Model/buildprod; cmake -DCMAKE_BUILD_TYPE=Release ..; cmake --build . --config Release

test:
  override:
    - cd Stormwater-Management-Model; tools/gen-config.sh `pwd`/buildprod/bin > ./tests/apps/swmm-<build id>.json; tools/run-nrtest.sh `pwd`/tests/swmm-nrtestsuite 5112
